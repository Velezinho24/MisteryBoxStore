{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Payment Successful" %} Â· MysteryVault{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-12 col-md-8 col-lg-6">
      <div class="card bg-dark border-success text-center">
        <div class="card-body p-5">
          <div class="mb-4">
            <i class="bi bi-check-circle-fill text-success" style="font-size: 5rem;"></i>
          </div>
          
          <h1 class="h3 fw-bold text-white mb-3">
            {% trans "Payment Successful!" %}
          </h1>
          
          {% if order_id %}
          <p class="lead text-light mb-4">
            {% trans "Order" %} <span class="text-success fw-bold">#{{ order_id }}</span>
          </p>
          
          <div class="alert alert-success bg-success bg-opacity-10 border-success mb-4">
            <i class="bi bi-file-earmark-pdf-fill me-2"></i>
            {% trans "Your invoice PDF has been generated" %}
          </div>
          
          <div class="d-grid gap-3">
            <a href="{% url 'payments:checkout_success' %}?order_id={{ order_id }}&download=1" 
               class="btn btn-success btn-lg" 
               id="downloadBtn">
              <i class="bi bi-download me-2"></i>{% trans "Download Invoice PDF" %}
            </a>
            
            <a href="{% url 'catalog:list' %}" class="btn btn-outline-light">
              <i class="bi bi-grid-3x3-gap me-2"></i>{% trans "Continue Shopping" %}
            </a>
            
            <a href="{% url 'home:home' %}" class="btn btn-outline-secondary">
              <i class="bi bi-house-door me-2"></i>{% trans "Back to Home" %}
            </a>
          </div>
          {% else %}
          <p class="text-light mb-4">
            {% trans "Your payment has been processed successfully" %}
          </p>
          
          <a href="{% url 'home:home' %}" class="btn btn-outline-light">
            <i class="bi bi-house-door me-2"></i>{% trans "Back to Home" %}
          </a>
          {% endif %}
        </div>
      </div>
      
      <div class="text-center mt-4">
        <small class="text-light" style="opacity: 0.7;">
          <i class="bi bi-envelope-fill me-1"></i>
          {% trans "A confirmation email has been sent to your registered email address" %}
        </small>
      </div>
    </div>
  </div>
</div>

<script>
// Auto-download PDF after 1 second
{% if order_id %}
setTimeout(function() {
  const downloadUrl = "{% url 'payments:checkout_success' %}?order_id={{ order_id }}&download=1";
  
  // Create invisible link and click it
  const link = document.createElement('a');
  link.href = downloadUrl;
  link.download = 'invoice_{{ order_id }}.pdf';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}, 1000);
{% endif %}
</script>
{% endblock %}